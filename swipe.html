<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Rain CSS > Swipe</title>
<!-- Framework CSS -->
<link rel="stylesheet" href="css/blueprint/screen.css" type="text/css" media="all" />
<link rel="stylesheet" href="css/blueprint/print.css" type="text/css" media="print" />
<!--[if lte IE 8]><link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->
<link rel="stylesheet" href="css/rain.css" type="text/css" media="all" />
<!--[if lt IE 9]><script type="text/javascript" src="js/html5.js"></script><![endif]-->
<style>
.tipCir {
	top: 75px;
	left: 5px;
}
</style>
</head>
<body class="body" id="body">
	<div class="header headerBlue">
		<nav class="listStyleNo posr clearfix"> <a href="#"
			class="headerLink headerLinkBlue l pr pl ib tdn">link1</a> <a
			href="#" class="headerLink headerLinkBlue l pr pl ib tdn">link2</a> <a
			href="#" class="headerLink headerLinkBlue l pr pl ib tdn">link3</a> </nav>
	</div>
	<div class="headerM headerGrey">
		<div class="container posr">
			<div class="l">
				<a class="tdn block ptll fsxxl" href="index.html">Rain CSS</a>
			</div>
		</div>
	</div>

	<div class="container mt">
		<div class="content">
			<div class="sidebar l posr">
				<h2 class="category">swipe with CSS3</h2>
				<p>This part is the webpage swipe</p>
			</div>
			<div class="main mainRight posr">
				<h1>swipe</h1>
				<form method="post" action="">
					<fieldset>
						<legend>Basic collapsibles</legend>
						<div class="c_touch posr">
							<div class=" c_touhmain posr oh">
								<ul class=" lsn c_touhlist posa nom nop w-mx clearfix">
									<li class="fl l"><a class='block fullw fullh' href='#'><img class='fullw fullh' src="images/s1.jpg" /></a></li>
									<li class="fl l"><a class='block fullw fullh' href='#'><img class='fullw fullh' src="" src3="images/s2.jpg"/></a></li>
									<li class="fl l"><a class='block fullw fullh' href='#'><img class='fullw fullh' src="" src3="images/s1.jpg"/></a></li>
									<li class="fl l"><a class='block fullw fullh' href='#'><img class='fullw fullh' src="" src3="images/s3.jpg" /></a></li>
								</ul>
							</div>
              <ul class="c_touchicon lsn clearfix posa nom nop tipCir">
               <li class="fl l posr c_tips mls"><i class="c_on round-10 w-1 h-1 block so bgy"></i></li>
               <li class="fl l posr c_tips mls"><i class="c_on round-10 w-1 h-1 block bgw so"></i></li>
               <li class="fl l posr c_tips mls"><i class="c_on round-10 w-1 h-1 block bgw so"></i></li>
               <li class="fl l posr c_tips mls"><i class="c_on round-10 w-1 h-1 block bgw so"></i></li>
              </ul>
             </div>
					</fieldset>
				</form>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="js/jquery-1.7.2.js"></script>
 <script type="text/javascript" src="js/util.js"></script>
	<script type="text/javascript"> 
	(function($) {	
		/**
		 *一个在手机端自动轮播,并且可以有滑动效果的插件---基于jquery.
		 * @param {Object} obj Object对象。可以自定义传入的参数。
		 * @return {Function} 返回的是一个公有的函数。
		 */
		$.swipe = function(opt) {
			var o = $.extend({
				touchSelector : ".c_touch",
				time : 2500,
				autorun: true,
				width:320,
				height:95,
				responsive: true
			}, opt || {});
			var touchobj = $(o.touchSelector),touchbox=touchobj.find('.c_touhmain'), touchlist = touchobj.find('.c_touhlist'), //图片的父级选择器
			$tips = touchobj.find('.c_tips'),  startX = 0, //开始点击的位置
			timer = o.time,
			i = 0, //图片计数器
			items = touchlist.find("li"), len = items.length, //图片的数目
			dirvalue = 0, //用于判断向左向右滑动
			_width = 0;
			var obj={
				setWidth : function(){
					if(o.responsive){ _width = touchobj.width();}
					else{_width = o.width;}
				},
				getWidth :  function(){
				  return _width;
				},
				initUI : function(){
				  obj.setWidth();
				  var w = obj.getWidth();
				  touchbox.height(o.height).width(w);
				  touchlist.height(o.height);
				  touchlist.find("li").height(o.height).width(w);
				},
				/**
				 *绑定事件函数:touchstart,touchmove,touchend
				 */
				bindEvent : function() {
					 touchobj[0].addEventListener('touchstart', obj.touchStart, false);
					 touchobj[0].addEventListener('touchmove', obj.touchMove, false);
					 touchobj[0].addEventListener('touchend', obj.touchEnd, false);
				},
				/**
				 *懒加载函数。
				 *@param {Number} index 为li的下标
				 *@param {Object} items jquery对象,关于li 的JQ对象。
				 */
				lazyLoad : function (index, items) {
			       var img = items.eq(index).find("img");
			       if (img.attr("src3")) {
			           img.attr("src", img.attr("src3")).removeAttr("src3");
			       }
			  },
				/**
				 *touchstart事件,获取初始点击的坐标值，来确定向左还是向右滑动同时清除定时器。
				 *@param {Object} evt Object对象,事件对象。
				 */
				touchStart : function(evt) {
					obj.lazyLoad(i+1,items);
					clearInterval(obj.timeHanlder);
					var touch = evt.touches[0]; //获取第一个触点
					//记录触点初始位置
					startX = parseInt(touch.pageX, 10);
				},
	
				/**
				 *touchmove事件,根据左右滑动来实现不同的效果。
				 *@param {Object} evt Object对象,事件对象。
				 */
				touchMove : function(evt) {
					evt.preventDefault();
					clearInterval(obj.timeHanlder);
				  var w = obj.getWidth();
					var touch = evt.touches[0]; //获取第一个触点
					dirvalue = parseInt((touch.pageX - startX), 10);
					//判断滑动方向
					if (dirvalue < 0) {
						touchlist.find('li').slice(len).remove();
					}
					touchlist.css({"left" : -i * w + dirvalue});
				},
	
				/**
				 *小图标显示函数
				 */
				tipShow : function() {
					i === len ? i = 0 : i;
					$tips.find('.c_on').addClass('bgw').removeClass('bgy');
					$tips.eq(i).find('.c_on').addClass('bgy').removeClass('bgw');
				},
	
				/**
				 *touchend处理函数.
				 *@param {Object} evt Object对象,事件对象。
				 */
				_touchends :  function() {
					if (dirvalue == 0) {return;}
					var w = obj.getWidth();
					if (dirvalue < 0) {
						i++;
						i >= len ? i = len - 1 : i;
					} else {
						i--;
						i < 0 ? i = 0 : i;
					}
					touchlist.animate({"left" : -i * w},function(){
						if(o.autorun) {
							touchlist.find('li').slice(0, 1).clone(true).appendTo('.c_touhlist');
						  obj.timeHanlder = setInterval(obj.setTime, 2 * timer);
						}
					});
					obj.tipShow();
					dirvalue = 0;
				},
	
				/**
				 *touchend事件,最后来确定显示用户所滑动的图像。同时生成定时器。
				 *@param {Object} evt Object对象,事件对象。
				 */
				touchEnd : function(evt) {
					obj._touchends();
				},
	
				/**
		  		 *定时轮播函数。
		  		 */
				setTime : function() {
					var w = obj.getWidth();
					i++;
					if (i > len - 2) {
						touchlist.stop().animate({"left" : -i * w}, function(){
							i = 0;
							touchlist.css({"left" : 0});
						});
					} else {
						touchlist.stop().animate({"left" : -i * w});
					}
					obj.lazyLoad(i,items);
					obj.tipShow();
				},
				init : function(){
					obj.initUI();
					if(util.supportTouch) obj.bindEvent();
					if(o.autorun){
					  touchlist.find('li').slice(0, 1).clone(true).appendTo('.c_touhlist');
						obj.timeHanlder = setInterval(obj.setTime,timer);
					}
				}
			}
			obj.init();
			return obj;
		}
	})(jQuery);
	var o = new $.swipe({autorun:true});
	</script>
</body>
</html>