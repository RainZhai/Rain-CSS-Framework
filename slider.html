<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<meta charset="utf-8">  
<title>Rain CSS > slider</title>
<!-- Framework CSS -->
<link rel="stylesheet" href="css/blueprint/screen.css" type="text/css" media="all"/>
<link rel="stylesheet" href="css/rain.css" type="text/css" media="all"/>
<style type="text/css">
.sliderbtn{top:50%;margin: -11px 0 0 -10px;left:0;}
</style>
</head>
<body class="body">
  <div class="headerBlue">
  	<nav class="lsn posr clearfix">
    	<a href="http://www.webdevelopmentmachine.com" target='_blank' class="headerLink headerLinkBlue tac fl l ib wf-33 tdn">首页home</a>
    	<a href="http://www.webdevelopmentmachine.com/blog" target='_blank' class="headerLink headerLinkBlue tac fl l ib wf-33 tdn">博客blog</a>
    	<a href="http://www.webdevelopmentmachine.com/demo/game.html" target='_blank' class="headerLink headerLinkBlue tac fl l ib wf-33 tdn">游戏game</a>
    </nav>
  </div>
	<div class="headerM headerGrey">
  	<div class="container posr">
    	<div class="l"><a class="tdn block ptll fsxxl" href="index.html">Rain CSS</a></div>
    </div>
  </div>
  
	<div class="container mt"> 
    <div class="content">
		<div class="sidebar l posr">
			<h2 class="category">slider</h2>
			<p>Sliders are used to enter numeric values along a continuum and can also be dual handle range sliders or flip switches.</p>
		</div>
      
		<div class="main mainRight posr">
			<h1>slider</h1>
			<fieldset>
				<legend>Basic loader</legend>
				<div class="ui-slider">
					<input type="number" data-type="range" name="slider-1" id="slider-1" min="0" max="100" value="50" class="" />
					<div role="application" class="j_sliderbar bglgrey2 rounds b so fullw h-1 posr ov">
						<div class="j_sliderbg1 fullh posa"></div>
						<div class="j_sliderbg2 fullh posa o-9"></div>
						<a href="javascript:;" class="j_sliderbtn1 sliderbtn ib w-2 h-2 bgw b rounds posa" role="slider"></a>
					</div>
				</div>
			</fieldset>
		</div>
   
    <footer class="footer socialFooter c bt">
      <p class="bottom pt pb">Copyright 2010-2014 Web Development Machine All rights reserved.</p>
    </footer> 
    </div>
  </div>
<script type="text/javascript" src="js/jquery-1.7.2.js"></script>
<script type="text/javascript" src="js/util.js"></script>
<script type="text/javascript">
(function ($,doc) {
	window.slider = $.slider = function(obj) {
	  this.obj = obj;
	  $.extend(this,{
	    barHandler:".j_sliderbar",
	    btnHandler:".j_sliderbtn1",
	    outputHandler:"#slider-1",
	    bgbarHandler:".j_sliderbg1",
	    bgbarStyle:{
	    	"background-color":"#fc7c26"
	    },
	    bgbarHandler2:".j_sliderbg2",
	    bgbarStyle2:{
	    	"background-color":"#000"
	    },
	    max:100,
	    min:1,
	    divs:20
	  }, this.obj || {});
	  this.bar = $(this.barHandler),this.btn = $(this.btnHandler),
	  this.output= $(this.outputHandler),
	  this.bgbar = $(this.bgbarHandler),
	  this.bgbar2 = $(this.bgbarHandler2),
	  this.drag=false,
	  this.value = 0,
	  this.x = 0,
	  this.y = 0,
	  this.leftValue = 0,
	  this.tempX = 0,
	  this.tempY = 0,
	  this.currentX = 0,
	  this.currentY = 0;
	  this.init();
	};
	slider.prototype = {
		barWidth:0,
		init:function(){
			var t = this;
			t.barWidth = t.bar.width();
			if(t.getMin()<t.getMax()){
				t.initProcess();
				t.initBgbar();
				t.registerEvents();
			}
		},
		setValue: function(i){
			this.value = i;
		},
		getValue: function(){
			return this.value;
		},
		setMin: function(i){
			this.min = i;
		},
		getMin: function(){
			return this.min;
		},
		setMax: function(i){
			this.max = i;
		},
		getMax: function(){
			return this.max;
		},
		/** 初始化背景条*/
		initBgbar: function(){
			var t = this;
			var per = t.getValue()/t.getMax();
			t.bgbar.css(t.bgbarStyle);
			t.bgbar.width(t.barWidth*per);
			
			var per2 = t.getMin()/t.getMax();
			t.bgbar2.css(t.bgbarStyle2);
			t.bgbar2.width(t.barWidth*per);
		},
		/** 初始化进度条*/
		initProcess: function(){
			var t = this;
			if(t.divs<1){
				if(t.getMin()>1){
					t.setValue(t.getMin());
					var w = t.transValuetoWidth(t.getValue());
					t.btn.css({"left":w+"px"});
				}
			}else{
				if(t.getMin()>1){
					var stepSize = parseInt(t.getMax()/t.divs,10);
					var minStep = parseInt(t.getMin()/stepSize,10);
					var residue = t.getMin()%stepSize;
					log(stepSize,minStep,residue);
					if(residue === 0){
						t.setValue(t.getMin());
					}else{
						if(residue>stepSize/2){
							t.setValue((minStep+1)*stepSize);
							t.setMin((minStep+1)*stepSize);
						}else{
							t.setValue(minStep*stepSize);
							t.setMin(minStep*stepSize);
						}
					}
					var w = t.transValuetoWidth(t.getValue());
					t.btn.css({"left":w+"px"});
				}
			}
			t.resetOutput();
		},
		/** 根据分割计算当前进度值 */
		resetValueByDiv: function(v){
			var t= this;
			if(v>0){
				if(t.divs>0){
					var stepSize = parseInt(t.getMax()/t.divs,10);
					var minStep = parseInt(v/stepSize,10);
					var residue = v%stepSize;
					if(residue === 0){
						t.setValue(v);
					}else{
						if(residue>stepSize/2){
							t.setValue((minStep+1)*stepSize);
						}else{
							t.setValue(minStep*stepSize);
						}
					}
				}else{
					if(t.getMin()>v){
						t.setValue(t.getMin());
					}else{
						t.setValue(v);
					}
				}
			}
		},
		/** 更新输出*/
		resetOutput: function(){
			var t = this;
			var v = t.getValue();
			t.output.val(v);
		},
		/** 更新背景条*/
		resetBgbar: function(){
			var t = this;
			var per = t.getValue()/t.getMax();
			t.bgbar.width(t.barWidth*per);
		},
		/** 将坐标转化为进度值 */
		transCoordinate: function(x){
			var t = this;
			var per = x/t.barWidth;
			var v = parseInt(t.getMax()*per,10);
			log(x,t.barWidth)
			return v;
		},
		/** 将进度值转换为宽度值 */
		transValuetoWidth: function(v){
			var t = this;
			if(v>0 && v<=t.getMax()){
				return parseInt(t.barWidth * (v/t.getMax()),10);
			} 
			return 0;
		},
		/** 注册事件 */
		registerEvents:function(){
			var me = this;
			me.btn.on("mousedown",function(e){
				var _this = $(this);
				me.drag = true;
				me.leftValue = _this.position().left;
				me.tempX=_this.offset().left;
				me.tempY=_this.offset().top;
				me.x=e.clientX;
				me.y=e.clientY;
			});
			$(doc).on("mousemove",function(e){
				var _this = $(this);
				var w = me.bar.width();
				me.currentX = me.leftValue + e.clientX-me.x;
				me.currentY = e.clientY;
				if(me.drag){
					if (me.currentX < me.transValuetoWidth(me.getMin())){
						me.currentX = me.transValuetoWidth(me.getMin());
					} 
					if (me.currentX>w){me.currentX=w;}
					var v = me.transCoordinate(me.currentX);
					me.resetValueByDiv(v);
					log(me.currentX,w,v,me.getMin(),me.transValuetoWidth(me.getValue()));
					me.btn.css({"left":me.transValuetoWidth(me.getValue())+"px"});
					me.resetOutput();
					me.resetBgbar();
				}
			});
			$(doc).on("mouseup",function(e){
				var _this = $(this);
				me.drag = false;
			});
		}
	}
	})(jQuery,document);
	var slider = new slider({
	    barHandler:".j_sliderbar",
	    btnHandler:".j_sliderbtn1",
	    outputHandler:"#slider-1",
	    bgbarHandler:".j_sliderbg1",
	    bgbarStyle:{
	    	"background-color":"#ffb17d"
	    },
	    bgbarHandler2:".j_sliderbg2",
	    bgbarStyle2:{
	    	"background-color":"#fc7c26"
	    },
	    max:100,
	    min:10,
	    divs:0
	});
</script>
</body>
</html>
