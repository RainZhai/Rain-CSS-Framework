(function($){window.slide=$.slide=function(opt){var opts=$.extend({selector:"#slide",src:[],alt:[],text:[],fix:false,width:320,space:0,itemwith:280,height:195,images:3,slides:1,length:40,control:true,controlwidth:100,loop:true,auto:false,speed:800,delay:5000,preloadamt:3,preventDefault:true,marginRight:20,easing:"swing",btnLeftStyle:{"left":"15px","top":"60px","width":"50px"},btnRightStyle:{"right":"15px","top":"60px","width":"50px"},before:function(){}},{},opt);var _selector=$(opts.selector);var src=opts.src,alt=opts.alt,text=opts.text;var s=src.length||_selector.find("ul").find("li").size();var slides=opts.slides,images=opts.images,ms=slides>images?slides:images;var i=0,starX=0;var timer;var finish=false;var _wrap=_selector.find(".slidewrap");var o={mainwidth:0,getBox:function(){return _selector},initUI:function(){if(src.length){var html='<div class="slidemain oh mlrauto"><ul class="slidewrap lsn nop nom w-mx clearfix">';for(var i=0;i<src.length;i++){if(i<images){html+='<li class="l fl"><a class="block ps tac" href="javascript:;"><img class="fullw b round-5" src="'+src[i]+'" alt="'+alt[i]+'"/><span class="ms block tac oh wwn toe">'+text[i]+"</span></a></li>"}else{html+='<li class="l fl"><a class="block ps tac" href="javascript:;"><img class="fullw b round-5" data-src="'+src[i]+'" alt="'+alt[i]+'"/><span class="ms block tac oh wwn toe">'+text[i]+"</span></a></li>"}}html+="</ul></div>";if(opts.control){html+='<a id="btnLeft" class="black posa b" href="javascript:;"></a><a id="btnRight" class="black posa b" href="javascript:;"></a>'}$(html).prependTo(_selector)}if(opts.fix){o.setWidth(opts.width);_selector.width(opts.width).height(o.getHeight())}else{o.setWidth(_selector.width())}if(opts.loop){_wrap.find("li").slice(0,ms).clone(true).appendTo(_wrap);_wrap.find("li").slice(s-ms,s).clone(true).prependTo(_wrap)}else{ms=0}if(opts.control){_selector.find(".slidemain").width(o.getWidth()-opts.controlwidth);_selector.find("#btnLeft").css(opts.btnLeftStyle);_selector.find("#btnRight").css(opts.btnRightStyle)}else{_selector.find(".slidemain").width(o.getWidth())}_wrap.css({"marginLeft":-ms*o.getItemWidth()-opts.space,"width":"99999px"}).find("li").each(function(){$(this).width(o.getItemWidth()-opts.marginRight).css({"margin-right":opts.marginRight+"px"})})},setWidth:function(v){o.mainwidth=v},getWidth:function(){return o.mainwidth},getHeight:function(){return opts.height},getItemWidth:function(){if(opts.control){return parseInt((o.getWidth()-opts.controlwidth)/images+opts.marginRight)}else{if(opts.fix){return parseInt(opts.itemwith+opts.marginRight)}return parseInt(o.getWidth()/images+opts.marginRight)}},getimages:function(){return opts.images},leftMove:function(){w=o.getItemWidth();if(!_wrap.is(":animated")){o.lazyLoad("left",i);if(!opts.loop&&i+images+slides>s){_wrap.stop().animate({marginLeft:-(s-images)*w},opts.speed,opts.easing,function(){i=s-images})}else{_wrap.stop().animate({marginLeft:"-="+slides*w},opts.speed,opts.easing,function(){i+=slides;if(i+slides>s){i=i-s;_wrap.css({marginLeft:-i*w-ms*w-opts.space})}})}}},rightMove:function(){w=o.getItemWidth();if(!_wrap.is(":animated")){o.lazyLoad("right",i);if(!opts.loop&&i-slides<0){_wrap.stop().animate({marginLeft:0},opts.speed,opts.easing,function(){i=0})}else{_wrap.stop().animate({marginLeft:"+="+slides*w},opts.speed,opts.easing,function(){i-=slides;if(i<0){i=i+s;_wrap.css({marginLeft:-i*w-ms*w-opts.space})}})}}},lazyLoad:function(towards,index){if(!finish){var _img=_wrap.find("img");var _item;if(towards=="left"){for(var i=0;i<opts.preloadamt;i++){_item=_img.eq(i+index+slides);if(_item.attr("data-src")){_item.attr("src",_item.attr("data-src")).removeAttr("data-src")}}o.judge(_img)}if(towards=="right"){for(var l=_img.length,i=l;i>l-opts.preloadamt;i--){_item=_img.eq(i-index-slides);if(_item.attr("data-src")){_item.attr("src",_item.attr("data-src")).removeAttr("data-src")}}o.judge(_img)}}},judge:function(img){finish=true;img.each(function(i){finish=false;return})},touchStar:function(event){o.endLoop();starX=parseInt(event.touches[0].clientX,10)},touchMove:function(event){if(opts.preventDefault){event.preventDefault()}o.endLoop()},touchEnd:function(event){var endX=parseInt(event.changedTouches[0].clientX,10);var d=parseInt((endX-starX),10);if(opts.preventDefault){event.preventDefault()}if(d<-opts.length){o.leftMove()}else{if(d>opts.length){o.rightMove()}}o.startLoop()},startLoop:function(){if(opts.auto){timer=setInterval(o.leftMove,opts.delay)}},endLoop:function(){if(opts.auto&&timer){clearInterval(timer)}},bindEvent:function(){if(util.supportTouch){_selector[0].addEventListener("touchstart",o.touchStar,false);_selector[0].addEventListener("touchend",o.touchEnd,false);_selector[0].addEventListener("touchmove",o.touchMove,false);_selector.find("#btnLeft")[0].addEventListener("touchstart",o.rightMove,false);_selector.find("#btnRight")[0].addEventListener("touchstart",o.leftMove,false)}else{_selector.find("#btnLeft").on("click",o.rightMove);_selector.find("#btnRight").on("click",o.leftMove)
}},init:function(){opts.before();o.initUI();o.startLoop();o.bindEvent()}};o.init();return o}})(window.jQuery||window.Zepto);