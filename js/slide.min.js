!function(a){window.slide=a.slide=function(b){var n,c=a.extend({selector:"#slide",src:[],alt:[],text:[],fix:!1,width:320,height:195,images:3,slides:1,length:40,control:!0,controlwidth:100,loop:!0,auto:!1,speed:800,delay:5e3,preloadamt:3,before:function(){}},{},b),d=a(c.selector),e=c.src,f=c.alt,g=c.text,h=e.length||d.find("ul").find("li").size(),i=c.slides,j=c.images,k=i>j?i:j,l=0,m=0,o=!1,p=d.find(".slidewrap"),q={mainwidth:0,getBox:function(){return d},initUI:function(){if(e.length){for(var b='<div class="slidemain oh mlrauto"><ul class="slidewrap lsn nop nom w-mx clearfix">',i=0;i<e.length;i++)b+=j>i?'<li class="l fl"><a class="block ps tac" href="javascript:;"><img class="fullw b round-5" src="'+e[i]+'" alt="'+f[i]+'"/><span class="ms block tac oh wwn toe">'+g[i]+"</span></a></li>":'<li class="l fl"><a class="block ps tac" href="javascript:;"><img class="fullw b round-5" data-src="'+e[i]+'" alt="'+f[i]+'"/><span class="ms block tac oh wwn toe">'+g[i]+"</span></a></li>";b+="</ul></div>",c.control&&(b+='<a id="btnLeft" class="black posa b" href="javascript:;"></a><a id="btnRight" class="black posa b" href="javascript:;"></a>'),a(b).prependTo(d)}c.fix?(q.setWidth(c.width),d.width(c.width).height(q.getHeight())):q.setWidth(d.width()),c.loop?(p.find("li").slice(0,k).clone(!0).appendTo(p),p.find("li").slice(h-k,h).clone(!0).prependTo(p)):k=0,c.control?(d.find(".slidemain").width(q.getWidth()-c.controlwidth),d.find("#btnLeft").css(c.btnLeftStyle),d.find("#btnRight").css(c.btnRightStyle)):d.find(".slidemain").width(q.getWidth()),p.css({marginLeft:-k*q.getItemWidth(),width:"99999px"}).find("li").each(function(){a(this).width(q.getItemWidth())})},setWidth:function(a){q.mainwidth=a},getWidth:function(){return q.mainwidth},getHeight:function(){return c.height},getItemWidth:function(){return c.control?(q.getWidth()-c.controlwidth)/j:q.getWidth()/j},getimages:function(){return c.images},leftMove:function(){w=q.getItemWidth(),p.is(":animated")||(q.lazyLoad("left",l),!c.loop&&l+j+i>h?p.stop().animate({marginLeft:-(h-j)*w},c.speed,function(){l=h-j}):p.stop().animate({marginLeft:"-="+i*w},c.speed,function(){l+=i,l+i>h&&(l-=h,p.css({marginLeft:-l*w-k*w}))}))},rightMove:function(){w=q.getItemWidth(),p.is(":animated")||(q.lazyLoad("right",l),!c.loop&&0>l-i?p.stop().animate({marginLeft:0},c.speed,function(){l=0}):p.stop().animate({marginLeft:"+="+i*w},c.speed,function(){l-=i,0>l&&(l+=h,p.css({marginLeft:-l*w-k*w}))}))},lazyLoad:function(a,b){if(!o){var e,d=p.find("img");if("left"==a){for(var f=0;f<c.preloadamt;f++)e=d.eq(f+b+i),e.attr("data-src")&&e.attr("src",e.attr("data-src")).removeAttr("data-src");q.judge(d)}if("right"==a){for(var g=d.length,f=g;f>g-c.preloadamt;f--)e=d.eq(f-b-i),e.attr("data-src")&&e.attr("src",e.attr("data-src")).removeAttr("data-src");q.judge(d)}}},judge:function(a){o=!0,a.each(function(){o=!1})},touchStar:function(a){q.endLoop(),m=parseInt(a.touches[0].clientX,10)},touchMove:function(a){a.preventDefault(),q.endLoop()},touchEnd:function(a){var b=parseInt(a.changedTouches[0].clientX,10),d=parseInt(b-m,10);a.preventDefault(),d<-c.length?q.leftMove():d>c.length&&q.rightMove(),q.startLoop()},startLoop:function(){c.auto&&(n=setInterval(q.leftMove,c.delay))},endLoop:function(){c.auto&&n&&clearInterval(n)},bindEvent:function(){util.supportTouch?(d[0].addEventListener("touchstart",q.touchStar,!1),d[0].addEventListener("touchend",q.touchEnd,!1),d[0].addEventListener("touchmove",q.touchMove,!1),d.find("#btnLeft")[0].addEventListener("touchstart",q.rightMove,!1),d.find("#btnRight")[0].addEventListener("touchstart",q.leftMove,!1)):(d.find("#btnLeft").on("click",q.rightMove),d.find("#btnRight").on("click",q.leftMove))},init:function(){c.before(),q.initUI(),q.startLoop(),q.bindEvent()}};return q.init(),q}}(jQuery||Zepto);