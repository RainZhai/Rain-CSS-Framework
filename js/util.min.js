(function(win,$){win.util=util={};util.touch={startX:0,startY:0,endX:0,endY:0,registerEvent:function(selector){if(arguments[1]&&$.isFunction(arguments[1])){selector[0].addEventListener("touchstart",arguments[1],false)}if(arguments[2]&&$.isFunction(arguments[2])){selector[0].addEventListener("touchmove",arguments[2],false)}if(arguments[3]&&$.isFunction(arguments[3])){selector[0].addEventListener("touchend",arguments[3],false)}},removeEvent:function(selector){if(arguments[1]&&$.isFunction(arguments[1])){selector[0].removeEventListener("touchstart",arguments[1],false)}},initTap:function(){var touch={},tapTimeout;var now,delta;$(function(){$(document).on("touchstart",function(e){now=Date.now();delta=now-(touch.last||now);var e=e.originalEvent;touch.el=$(e.touches[0].target);if(delta>0&&delta<=250){touch.isDoubleTap=true}touch.last=now}).on("touchmove",function(e){var e=e.originalEvent;cancelAll()}).on("touchend",function(e){if("last" in touch){tapTimeout=setTimeout(function(){touch.el.trigger("tap");if(touch.isDoubleTap){touch.el.trigger("doubleTap");touch={}}},10)}}).on("touchcancel",cancelAll)});function cancelAll(){if(tapTimeout){clearTimeout(tapTimeout)}tapTimeout=null;touch={}}["doubleTap","tap"].forEach(function(m){$.fn[m]=function(callback){return this.on(m,callback)}})},scrollable:function(scrollHandler){var css={"-webkit-overflow-scrolling":"touch","overflow-y":"auto"};var preventDefault=function(e){e.preventDefault()};var stopPropagation=function(e){e.stopPropagation()};var stopeve2=function(e){if(e.currentTarget.scrollTop===0){e.currentTarget.scrollTop=1}else{if(e.currentTarget.scrollHeight===e.currentTarget.scrollTop+e.currentTarget.offsetHeight){e.currentTarget.scrollTop-=1}}};if(arguments.length===1){$(scrollHandler).css(css);$(document).on("touchmove",function(e){preventDefault(e)});$("body").on("touchstart",scrollHandler,function(e){stopeve2(e)});$("body").on("touchmove",scrollHandler,function(e){stopPropagation(e)})}if(arguments.length>1&&arguments[1]=="off"){$(scrollHandler).css({});$(document).off("touchmove");$("body").off("touchstart");$("body").off("touchmove")}}};if(util.supportTouch){util.touch.initTap()}if(!win.console){win.console=function(){};win.console.info=win.console.debug=win.console.warn=win.console.log=win.console.error=function(str){alert(str)}}win.log=function(){if(arguments.length>0){var s="";for(var i=0,l=arguments.length;i<l;i++){s=s+arguments[i]+","}console.log(util.clearLastComma(s))}};if(util.isAndroid){win.w=win.document.body.offsetWidth;win.h=win.document.body.offsetHeight}else{win.w=win.screen.width;win.h=win.screen.height}if(util.supportTouch){util.touch.click="tap"}else{util.touch.click="click"}function detectBrowser(ns){var ua=ns.ua=navigator.userAgent;ns.isWebKit=(/webkit/i).test(ua);ns.isMozilla=(/mozilla/i).test(ua);ns.isIE=(/msie/i).test(ua);ns.isFirefox=(/firefox/i).test(ua);ns.isChrome=(/chrome/i).test(ua);ns.isSafari=(/safari/i).test(ua)&&!this.isChrome;ns.isMobile=(/mobile/i).test(ua);ns.isOpera=(/opera/i).test(ua);ns.isIOS=(/ios/i).test(ua);ns.isIpad=(/ipad/i).test(ua);ns.isIpod=(/ipod/i).test(ua);ns.isIphone=(/iphone/i).test(ua)&&!this.isIpod;ns.isAndroid=(/android/i).test(ua);ns.supportStorage="localStorage" in win;ns.supportOrientation="orientation" in win;ns.supportDeviceMotion="ondevicemotion" in win;ns.supportTouch="ontouchstart" in win;ns.supportCanvas=document.createElement("canvas").getContext!==null;ns.cssPrefix=ns.isWebKit?"webkit":ns.isFirefox?"Moz":ns.isOpera?"O":ns.isIE?"ms":""}detectBrowser(util);util.clearLastComma=function(str){str=str.replace(/,$/,"");return str};util.checkprop=function(propName,obj){return propName in obj};util.queryByTag=function(t){return document.getElementsByTagName(t)};util.queryById=function(t){return document.getElementById(t)};util.getRandomNum=function(min,max){if(max>min){var Range=max-min;var Rand=Math.random();return(min+Math.round(Rand*Range))}return 0};util.setCookie=function(c_name,value,expiredays){if(c_name&&value){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=c_name+"="+escape(value)+((expiredays==null)?"":";expires="+exdate.toGMTString())}};util.getCookie=function(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""};util.delCookie=function(name){var exp=new Date();exp.setTime(exp.getTime()-1);var cval=Common.getCookie(name);if(cval!=null){document.cookie=name+"="+cval+";expires ="+exp.toGMTString()}};util.swapItems=function(arr,index1,index2){arr[index1]=arr.splice(index2,1,arr[index1])[0];return arr};util.setlist=function(name,val){var list=Common.getCookie(name);if(list){var arr=list.split(",");if(arr.length<5){if(arr.indexOf(val)>0){var i=arr.indexOf(val);Common.swapItems(arr,0,i)}else{arr.unshift(val)}Common.setCookie(name,arr.join(","))
}else{if(arr.indexOf(val)>0){var i=arr.indexOf(val);Common.swapItems(arr,0,i)}else{arr.unshift(val)}arr.pop();Common.setCookie(name,arr.join(","))}}else{Common.setCookie(name,val)}};util.pushState=function(obj){if(history&&util.checkprop("pushState",history)){var opt=$.extend({data:{},title:""},obj||{});history.pushState(opt.data,opt.title,opt.url)}};util.replaceState=function(obj){if(history&&util.checkprop("replaceState",history)){var opt=$.extend({data:{},title:"",url:""},obj||{});history.replaceState(opt.data,opt.title,opt.url)}};util.state=function(){if(history&&util.checkprop("state",history)){return history.state}};util.getTitle=function(){var t=util.queryByTag("title");if(t.length>0){return t[0].innerText}return""};util.registerStateChange=function(callback){if("onpopstate" in win){win.onpopstate=function(){callback()}}};util.initObjByUrl=function(obj){var urlparam=location.href.split("?")[1];if(urlparam&&obj&&urlparam in obj){obj[urlparam]()}};util.savedata=function(k,v){if(util.supportStorage&&k&&v){localStorage.setItem(k,v)}};util.getdata=function(k){if(util.supportStorage&&k){return localStorage.getItem(k)}return null};util.urlChanger=function(){var _this=this;_this.observers=[];_this.addObserver=function(obj){_this.observers.push(obj)};_this.deleteObserver=function(obj){_this.observers.slice(0,_this.observers.length)};_this._notifyObservers=function(){var length=_this.observers.length;console.log(length);for(var i=0;i<length;i++){_this.observers[i].update()}};_this.changeUrl=function(hash){window.location.hash=hash;_this._notifyObservers()}};util.urlObservers=function(callball){var _this=this;if(typeof(callball)=="function"){_this.update=callball}};util.routes={};util.routeopen=false;util.addRoute=function(path,templateId,controller){util.routes[path]={templateId:templateId,controller:controller};if(!util.routeopen){util.routeopen=true;util.registerHashchange()}};util.removeRoute=function(path){util.routes[path]=null};util.router=function(){var url=location.hash.slice(1)||"/";var route=util.routes[url];if(route&&route.controller){route.controller()}};util.registerHashchange=function(){if("onhashchange" in win){win.onhashchange=function(){util.router()};win.onload=function(){util.router()}}};util.extend=function(subClass,superClass){var F=function(){};F.prototype=superClass.prototype;subClass.prototype=new F();subClass.prototype.constructor=subClass;subClass.superclass=superClass.prototype;if(superClass.prototype.constructor==Object.prototype.constructor){superClass.prototype.constructor=superClass}};util.clone=function(object){function F(){}F.prototype=object;return new F};util.augment=function(receivingClass,givingClass){if(arguments[2]){for(var i=2,len=arguments.length;i<len;i++){receivingClass.prototype[arguments[i]]=givingClass.prototype[arguments[i]]}}else{for(methodName in givingClass.prototype){if(!receivingClass.prototype[methodName]){receivingClass.prototype[methodName]=givingClass.prototype[methodName]}}}};var emptyConstructor=function(){};util.inherit=function(childClass,parentClass){emptyConstructor.prototype=parentClass.prototype;childClass.superClass=parentClass.prototype;childClass.prototype=new emptyConstructor();childClass.prototype.constructor=childClass};util.merge=function(obj,props,strict){for(var key in props){if(!strict||obj.hasOwnProperty(key)||obj[key]!==undefined){obj[key]=props[key]}}return obj};util.cacheImg=function(obj,type,callback){var w=obj.width,h=obj.height;var canvas=util.createDOM("canvas",{width:w,height:h});var image=new Image();image.src=obj.src;if(canvas===null){return false}var context=canvas.getContext("2d");context.fillStyle="#EEEEFF";context.fillRect(0,0,w,h);image.onload=function(){context.drawImage(image,0,0);var img=new Image();img.width=w;img.height=h;img.src=canvas.toDataURL(type||"image/png");callback(img)}};util.createDOM=function(type,props){var dom=document.createElement(type);for(var p in props){var val=props[p];if(p=="style"){for(var s in val){dom.style[s]=val[s]}}else{dom[p]=val}}return dom};util.binarySearch=function(srcArray,des){var low=0;var high=srcArray.length-1;while(low<=high){var middle=parseInt((low+high)/2,10);if(des==srcArray[middle].name){return middle}else{if(des<srcArray[middle].name){high=middle-1}else{low=middle+1}}}return high+1};util.filter=function(s){var pattern=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）&dash;—|{}【】‘；：”“'。，、？ % + ]");var rs="";for(var i=0;i<s.length;i++){rs=rs+s.substr(i,1).replace(pattern,"")}return rs};util.dataBinder=function(object_id){var pubSub={callbacks:{},on:function(msg,callback){this.callbacks[msg]=this.callbacks[msg]||[];this.callbacks[msg].push(callback)},publish:function(msg){this.callbacks[msg]=this.callbacks[msg]||[];for(var i=0,len=this.callbacks[msg].length;i<len;i++){this.callbacks[msg][i].apply(this,arguments)}}},data_attr="data-bind-"+object_id,message=object_id+":change",changeHandler=function(event){var target=event.target||event.srcElement,prop_name=target.getAttribute(data_attr);
if(prop_name&&prop_name!==""){pubSub.publish(message,prop_name,target.value)}};if(document.addEventListener){document.addEventListener("keyup",changeHandler,false)}else{document.attachEvent("onkeyup",changeHandler)}pubSub.on(message,function(event,prop_name,new_val){var elements=document.querySelectorAll("["+data_attr+"="+prop_name+"]"),tag_name;for(var i=0,len=elements.length;i<len;i++){tag_name=elements[i].tagName.toLowerCase();if(tag_name==="input"||tag_name==="textarea"||tag_name==="select"){elements[i].value=new_val}else{elements[i].innerHTML=new_val}}});return pubSub};util.preview=function(file,callback){var reader=new FileReader();reader.onload=function(e){var $img=$("<img>").attr("src",e.target.result);if(typeof(callback)=="function"){callback($img)}};reader.readAsDataURL(file)};util.loading=$.fn.loading=$.loading=function(obj){var opt=$.extend({icon:true,content:"",loadingStyle:{},loadingClass:"",textStyle:{"font-size":"1.2em"},textClass:""},obj||{});var randomStr=Math.round(Math.random()*1000000+1)+"",_content=opt.content;var o={htmlobj:null,init:function(){o.initHtml();o.initUI()},initHtml:function(){if(!o.html){o.html=$('<div id="j_loader'+randomStr+'" class="j_loader'+randomStr+' ui-loader  posa fullh fullw hide"><div class="j_loadermain loadermain mlrauto round-5"><span class="j_icon ui-icon-loading block center roundall o-5"></span><div class="j_content tac"></div></div></div>')}if(_content){o.html.find(".j_content").html(_content)}return o.html},initUI:function(){o.html.find(".j_loadermain").addClass(opt.loadingClass);if(!opt.icon){o.html.find(".j_icon").hide()}o.html.find(".j_loadermain").css(opt.loadingStyle);o.html.find(".j_content").css(opt.textStyle);o.html.find(".j_content").addClass(o.textClass);$("body").append(o.html)},setContent:function(s){o.html.find(".j_content").html(s);return o},showIcon:function(v){if(!v){o.html.find(".j_loadermain").hide()}else{o.html.find(".j_loadermain").show()}return o},show:function(delay){o.html.show();if(delay>0){setTimeout(function(){o.html.hide()},delay)}return o},hide:function(){o.html.hide();return o},getHtml:function(){return o.html}};o.init();return o};util.listload=$.listload=function(obj,callback){var opt=$.extend({lastItemHandle:".list:last-child",loadurl:"",params:null,wrapHandle:"#listbox",loading:null,stop:false,scrollObj:window},obj||{});var win=$(opt.scrollObj);var wrapbox=$(opt.wrapHandle);var stop=opt.stop;var o={getDatabox:function(){return wrapbox},setParams:function(obj){opt.params=obj},getParams:function(){return opt.params},setData:function(d){o.data=d},getData:function(){return o.data},setStop:function(v){stop=v},init:function(){win.scroll(function(){log(stop);if(!stop&&$(opt.lastItemHandle).is(":visible")){if(win.scrollTop()+win.height()>=$(document).height()){o.setStop(true);if(opt.loadurl){var p=o.getParams();if(opt.loading){opt.loading.show()}$.getJSON(opt.loadurl,p,function(data){o.setData(data);if($.isFunction(callback)){callback()}})}}}});$(document).ready(function(){var a=$,b=document,c=a(".j_mainContent "),d=a(".j_sidebar");if(d.length>0){var e=d.offset().top,f=d.find(".anchor-btn"),g=function(){for(var b=[],c=0;c<f.length;c++){b.push(a(a(f[c]).attr("href")).offset().top)}return b},h=g(),i=function(b){for(var c,b=b+86,d=0;d<h.length;d++){if(b<h[d+1]){c=d;break}}void 0==c&&(c=d-1),f.parent("li").find("a").removeClass("on"),a(f[c]).parent("li").find("a").addClass("on")},j=function(a){a>e&&!d.hasClass("tab-fix-top")&&(d.addClass("tab-fix-top")),e>a&&d.hasClass("tab-fix-top")&&(d.removeClass("tab-fix-top"))};a(window).on("scroll",function(c){var d=a(b).scrollTop();j(d),i(d)}),a(window).on("resize",function(e){d.hasClass("tab-fix-top");var f=a(b).scrollTop();j(f),i(f)}),a(".anchor-btn").on("click",function(b){var c=a(this);setTimeout(function(){f.parent("li").find("a").removeClass("on"),c.parent("li").find("a").addClass("on")},50)});var k=a(b).scrollTop();j(k)}})}};o.init();return o}})(window,window.jQuery||window.Zepto);